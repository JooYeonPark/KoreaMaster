<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
       
<mapper namespace = "kr.or.kosta.koreaMaster.travel.trip">

<!-- 생성 -->
<insert id="create" parameterType="Trip">
	<selectKey keyProperty="no" order="BEFORE" resultType="int">
		SELECT trip_seq.NEXTVAL as no FROM DUAL
	</selectKey>
	INSERT INTO trip 
            (trip_no, 
             trip_name, 
             trip_start_date, 
             trip_end_date, 
             personal_flag) 
	VALUES     (#{no}, 
	            #{name}, 
	            To_date(#{startDate}, 'YYYY-MM-DD'), 
	            To_date(#{endDate}, 'YYYY-MM-DD'), 
	            'Y') 
</insert>

<!-- 조회 -->
<select id="read" parameterType="int" resultType="Trip">
	SELECT trip_no 			AS 	"no", 
      		trip_name 		AS	"name",
      		trip_start_date AS  "startDate", 
       		trip_end_date   AS	"endDate", 
       		personal_flag 	AS	"personalFlag"
	FROM   trip
	WHERE  trip_no = #{value}
</select>

<!-- 전체 조회 -->
<select id="listAll" resultType="Trip">
	SELECT trip_no 			AS 	"no", 
      		trip_name 		AS	"name",
      		trip_start_date AS  "startDate", 
       		trip_end_date   AS	"endDate", 
       		personal_flag 	AS	"personalFlag"
	FROM   trip
</select>

<!-- 수정 -->
<update id="update" parameterType="Trip">
	UPDATE TRIP
	SET trip_name = #{name}, trip_start_date = #{startDate}, trip_end_date = #{endDate}
	WHERE trip_no = #{no}
</update>

<!-- 삭제 -->
<delete id="delete" parameterType="int">
	DELETE FROM trip
	WHERE TRIP_NO = #{value}
</delete>

<!-- 현재 trip의 모든 list의 routeNo, tripNo반환 -->
<select id="getTrip" resultType="RouteInfo">
	SELECT t.trip_no 	AS	"tripNo", 
	       s.route_no	AS	"routeNo" 
	FROM   trip t, 
	       small_trip s 
	WHERE  t.trip_no = s.trip_no
</select>

<!-- 테이블에 있는 모든 route의 spot 정보 반환 -->
<select id="getSpot" resultType="RouteInfo">
	SELECT DISTINCT sigungu.sigun_name		AS	"sigunName", 
					sigungu.gu_name			AS	"guName", 
	                spot.spot_name			AS  "name", 
	                spot.spot_detail		AS	"detail", 
	                spot.spot_address_detail AS  "addressDetail", 
	                spot.spot_operating_hour AS  "operatingHour", 
	                spot.spot_closed_date	 AS	 "closedDate", 
	                spot.spot_phone			 AS   "phone", 
	                spot.spot_fare			 AS   "fare", 
	                spot.spot_homepage		 AS   "homepage", 
	                a.route_no 		  		 AS    "routeNo"
	FROM   route a, 
	       route b, 
	       spot, 
	       sigungu 
	WHERE  a.next_route_no = b.route_no 
	       AND a.spot_no = spot.spot_no 
	       AND sigungu.city_no = spot.city_no
</select>
</mapper>